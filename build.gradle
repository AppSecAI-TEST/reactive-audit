
buildscript {
    repositories {
        maven {
            url "https://maven.eveoh.nl/content/repositories/releases"
        }
    }

    dependencies {
        classpath "nl.eveoh:gradle-aspectj:1.4"
    }
}

repositories {
    mavenCentral()
}

project.ext {
    aspectjVersion = '1.8.0'
}

//apply plugin: 'java'
apply plugin: 'aspectj'

sourceCompatibility = '8'
targetCompatibility = '8'
version = '1.0'

dependencies {
    compile "org.aspectj:aspectjrt:${aspectjVersion}"
    compile "org.aspectj:aspectjtools:${aspectjVersion}"
    testCompile group: 'junit', name: 'junit', version: '4.11'
    //testCompile "org.aspectj:aspectjrt:${aspectjVersion}"
    //testcompile "org.aspectj:aspectjtools:${aspectjVersion}"
    testRuntime "org.aspectj:aspectjweaver:${aspectjVersion}"
    testRuntime "org.aspectj:aspectjrt:${aspectjVersion}"

}

task wrapper(type: Wrapper) {
    gradleVersion = '1.12'
}

test {
    // Juste pour afficher les logs dans les tests
    testLogging.showStandardStreams = true
    beforeTest { descriptor ->
        logger.lifecycle("Running test: " + descriptor)
    }

    include 'com/octo/reactive/audit/**'
//    include 'com/octo/reactive/audit/java/lang/**'
//    include 'com/octo/reactive/audit/java/io/**'
    def weaver="-javaagent:" +
        project.configurations.testRuntime.find { it.name.startsWith("aspectjweaver-") }
    def auditReactiveConf="-DauditReactive=testAuditReactive.properties"
    jvmArgs = [weaver,auditReactiveConf]
}
